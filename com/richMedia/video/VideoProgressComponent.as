/** VideoProgressComponent * ------------------------------------------------------------------------------------- * @ description: Progress bar video component built to work with video players. * @ usage: refer to documentation for usage. * @ developer: Neil Katz * @ version: 1.0.0  02.13.2014 * ------------------------------------------------------------------------------------- * */package com.richMedia.video{	import com.greensock.TweenNano;	import com.richMedia.constants.Constants;	import com.richMedia.events.EventBroadcaster;	import com.richMedia.events.RmVideoEvent;	import com.richMedia.managers.NotificationManager;	import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.geom.Rectangle;	public class VideoProgressComponent extends MovieClip	{		public var playerID         : String = Constants.PLAYER_DEFAULT_ID;		public var bar_mc 		    : MovieClip;		public var loadBar_mc 		: MovieClip;		public var progressBar_mc 	: MovieClip;		public var sliderBtn_mc 	: MovieClip;		private var sliderRect		: Rectangle;		private var sliderLimit		: int;		private var progressPos     : Number;		private var sliderPressed	: Boolean;		public function VideoProgressComponent()		{			if( this.stage ) init();			else addEventListener( Event.ADDED_TO_STAGE, init );		}		private function init( e:Event = null ):void		{			removeEventListener( Event.ADDED_TO_STAGE, init );			sliderBtn_mc    = this["sliderBtn_mc"];			bar_mc          = this["bar_mc"];			loadBar_mc      = this["loadBar_mc"];			progressBar_mc  = this["progressBar_mc"];			this.buttonMode = true;			loadBar_mc.mouseEnabled = false;			progressBar_mc.mouseEnabled = false;			progressBar_mc.width = 0;			loadBar_mc.visible = false;			loadBar_mc.scaleX = 0;			sliderLimit = Math.round ( bar_mc.width - sliderBtn_mc.btn_mc.width );			sliderRect = new Rectangle ( 0, 0, sliderLimit, 0 );			setListeners();		}		private function destroy( e:Event ):void		{			removeListeners();			sliderRect      = null;			sliderBtn_mc    = null;			bar_mc          = null;			loadBar_mc      = null;			progressBar_mc  = null;		}		private function btnEvents( e:MouseEvent ):void		{			switch( e.type )			{				case MouseEvent.MOUSE_DOWN:					if( e.target == sliderBtn_mc ) startDragging();					break;				case MouseEvent.MOUSE_OVER:					if( e.target == sliderBtn_mc ) btnOver();					break;				case MouseEvent.MOUSE_OUT:					if( e.target == sliderBtn_mc ) btnOut();					break;				case MouseEvent.MOUSE_UP:					stopDragging();					break;				case MouseEvent.CLICK:					if( e.target == bar_mc ) videoSeekToPoint();					break;			}		}		private function startDragging():void		{			sliderPressed = true;			sliderBtn_mc.startDrag( false, sliderRect );		}		private function stopDragging():void		{			sliderPressed = false;			sliderBtn_mc.stopDrag();		}		private function btnOut():void		{			sliderBtn_mc.gotoAndStop( "out" );		}		private function btnOver():void		{			sliderBtn_mc.gotoAndStop( "over" );		}		private function updateControls( obj:Object ):void		{			if( obj.data.playerID != playerID ) return;			var pos:Number = obj.data.progress;			updateSlider ( pos );			updateProgressBar();		}		private function resetControls( obj:Object ):void		{			if( obj.data.playerID != playerID ) return;			loadBar_mc.scaleX = 0;			progressBar_mc.width = 0;			sliderBtn_mc.x = 0;		}		private function updateProgressBar():void		{            TweenNano.to( progressBar_mc,.3, {width:progressPos});		}		private function updateLoadBar( obj:Object ):void		{			if( obj.data.playerID != playerID ) return;			loadBar_mc.visible = true;			loadBar_mc.scaleX = obj.data.bytesLoaded;		}		private function videoSeekToPoint():void		{			var _seekValue:Number = ( bar_mc.mouseX ) / sliderLimit;			NotificationManager.sendNotification( RmVideoEvent.SEEK_VIDEO, { seekPos:_seekValue, playerID:playerID } );		}		private function updateSlider( pos:Number ):void		{			if ( !sliderPressed )			{				progressPos = Math.floor ( sliderLimit * pos );                TweenNano.to( sliderBtn_mc,.3, {x:progressPos});			}			else			{				var _seekValue:Number = ( sliderBtn_mc.x ) / sliderLimit;				NotificationManager.sendNotification( RmVideoEvent.SEEK_VIDEO, { seekPos:_seekValue, playerID:playerID } );                progressPos = sliderBtn_mc.x;                updateProgressBar();			}            if( this.stage ) this.stage.invalidate();		}		public function setListeners():void		{			sliderBtn_mc.mouseChildren = false;			addEventListener( Event.REMOVED_FROM_STAGE, destroy );			stage.addEventListener( MouseEvent.MOUSE_UP,   btnEvents );			addEventListener( MouseEvent.MOUSE_DOWN,       btnEvents );			addEventListener( MouseEvent.MOUSE_OVER,       btnEvents );			addEventListener( MouseEvent.MOUSE_OUT,        btnEvents );			addEventListener( MouseEvent.CLICK,            btnEvents );			NotificationManager.regisiterNotificationInterest( RmVideoEvent.VIDEO_COMPLETE, resetControls );			NotificationManager.regisiterNotificationInterest( RmVideoEvent.VIDEO_CLEARED, resetControls );			NotificationManager.regisiterNotificationInterest( RmVideoEvent.VIDEO_PROGRESS, updateControls );			NotificationManager.regisiterNotificationInterest( RmVideoEvent.VIDEO_BYTES_LOADED, updateLoadBar );		}		public function removeListeners():void		{			removeEventListener( Event.REMOVED_FROM_STAGE, destroy );			stage.removeEventListener( MouseEvent.MOUSE_UP,   btnEvents );			removeEventListener( MouseEvent.MOUSE_DOWN,       btnEvents );			removeEventListener( MouseEvent.MOUSE_OVER,       btnEvents );			removeEventListener( MouseEvent.MOUSE_OUT,        btnEvents );			removeEventListener( MouseEvent.CLICK,            btnEvents );			NotificationManager.removeNotificationInterest( RmVideoEvent.VIDEO_COMPLETE, resetControls );			NotificationManager.removeNotificationInterest( RmVideoEvent.VIDEO_CLEARED, resetControls );			NotificationManager.removeNotificationInterest( RmVideoEvent.VIDEO_PROGRESS, updateControls );			NotificationManager.removeNotificationInterest( RmVideoEvent.VIDEO_BYTES_LOADED, updateLoadBar );		}	}}